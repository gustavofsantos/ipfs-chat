(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var a=n(8),r=n(0),c=n.n(r),o=n(3);function s(){var t=Object(r.useState)(""),n=Object(a.a)(t,2),s=n[0],u=n[1],i=Object(r.useContext)(o.b),l=i.ipfs,m=i.topic,f=i.user,p=Object(r.useCallback)(function(e){u(e.target.value)},[]),b=Object(r.useCallback)(function(t){t.preventDefault(),l.pubsub.publish(m,e.from(JSON.stringify({fromUser:f,message:s}))),u("")},[s,l,m,f]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("form",{className:"new-message",onSubmit:b},c.a.createElement("input",{className:"new-message__input",value:s,onChange:p}),c.a.createElement("button",{className:"new-message__button",type:"submit"},"send")))}}).call(this,n(34).Buffer)},24:function(e,t,n){e.exports=n(38)},29:function(e,t,n){},3:function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return o});var a=n(0),r=n.n(a),c=r.a.createContext(null),o=r.a.createContext(null)},38:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(20),o=n.n(c),s=(n(29),n(8)),u=n(10),i=n(1),l=n(3),m="APP_SET_IPFS_NODE",f="CHAT_SET_USER",p="CHAT_SET_TOPIC",b="CHAT_PUSH_MESSAGE",d=function(e){return{type:b,payload:e}},g=function(e){return{type:f,payload:e}},h=function(e){return{type:p,payload:e}},v=function(e){return{type:m,payload:e}};var E=Object(i.e)(function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),u=Object(s.a)(o,2),i=u[0],m=u[1],f=Object(a.useContext)(l.a),p=Object(a.useCallback)(function(e){e.preventDefault(),f(g(n)),f(h(i))},[n,i,f]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:p},r.a.createElement("input",{value:n,onChange:function(e){return c(e.target.value)},placeholder:"your user name"}),r.a.createElement("input",{className:"mg-bottom-16",value:i,onChange:function(e){return m(e.target.value)},placeholder:"topic to subscribe"}),r.a.createElement("button",{type:"submit"},"join!")))});var O=Object(i.e)(function(e){var t=Object(a.useContext)(l.b),n=Object(a.useContext)(l.a),c=e.history;return Object(a.useEffect)(function(){t.user&&t.topic&&window.Ipfs.create({EXPERIMENTAL:{pubsub:!0},repo:"ipfs-".concat(Math.random())}).then(function(e){return n(v(e)),e}).then(function(e){return e.pubsub.subscribe(t.topic,function(e){n(d(e))})}).then(function(){c.push("/chat")})},[t.user,t.topic,n,c]),r.a.createElement("div",{className:"page__join"},r.a.createElement("div",{className:"mg-bottom-32"},r.a.createElement("h1",null,"Hellow"),r.a.createElement("h4",null,"Welcome to IPFS Chat!")),r.a.createElement(E,null))});function j(){var e=Object(a.useContext)(l.b),t=e.user,n=e.topic;return r.a.createElement("header",{className:"header"},r.a.createElement("p",null,t," ","@"," ",n))}function w(e){var t=e.message,n=Object(a.useContext)(l.b).user,c=t.seqno.toString(),o=t.data.toString(),s=JSON.parse(o),u="message ".concat(s.fromUser===n?"my-message":"other-message");return r.a.createElement("li",{key:c},r.a.createElement("div",{className:u},r.a.createElement("p",{className:"message__author"},s.fromUser),r.a.createElement("p",{className:"message__text"},s.message)))}function y(){var e=Object(a.useContext)(l.b).messages;return r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"messages"},e.map(function(e){return r.a.createElement(w,{message:e})})))}var C=n(22);var S=Object(i.e)(function(e){var t=Object(a.useContext)(l.b).ipfs,n=e.history;return Object(a.useEffect)(function(){t||n.push("/")},[n,t]),r.a.createElement("div",{className:"page__chat"},r.a.createElement(j,null),r.a.createElement(y,null),r.a.createElement(C.a,null))}),_=n(23),N=n(7),k={user:null,topic:"",messages:[],ipfs:null};function x(e,t){switch(t.type){case b:return Object(N.a)(Object(N.a)({},e),{},{messages:[].concat(Object(_.a)(e.messages),[t.payload])});case f:return Object(N.a)(Object(N.a)({},e),{},{user:t.payload});case p:return Object(N.a)(Object(N.a)({},e),{},{topic:t.payload});case m:return Object(N.a)(Object(N.a)({},e),{},{ipfs:t.payload});default:return e}}var A=function(){var e=Object(a.useReducer)(x,k),t=Object(s.a)(e,2),n=t[0],c=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a.Provider,{value:c},r.a.createElement(l.b.Provider,{value:n},r.a.createElement(u.a,{basename:"/ipfs-chat"},r.a.createElement("div",{className:"page"},r.a.createElement(i.a,{path:"/",exact:!0,component:O}),r.a.createElement(i.a,{path:"/chat",component:S}))))))},P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function T(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}o.a.render(r.a.createElement(A,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/ipfs-chat",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/ipfs-chat","/service-worker.js");P?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):T(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):T(t,e)})}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.9b8b4bc5.chunk.js.map