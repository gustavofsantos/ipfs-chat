(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{2:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return c});var a=n(0),r=n.n(a),o=r.a.createContext(null),c=r.a.createContext(null)},22:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var a=n(7),r=n(0),o=n.n(r),c=n(2);function s(){var t=Object(r.useState)(""),n=Object(a.a)(t,2),s=n[0],i=n[1],u=Object(r.useContext)(c.b),l=u.ipfs,m=u.topic,f=u.user,p=Object(r.useCallback)(function(e){i(e.target.value)},[]),b=Object(r.useCallback)(function(t){t.preventDefault(),console.log("shoud publish",s),l.pubsub.publish(m,e.from(JSON.stringify({fromUser:f,message:s}))),i("")},[s,l,m,f]);return o.a.createElement(o.a.Fragment,null,o.a.createElement("form",{className:"new-message",onSubmit:b},o.a.createElement("input",{className:"new-message__input",value:s,onChange:p}),o.a.createElement("button",{className:"new-message__button",type:"submit"},"send")))}}).call(this,n(39).Buffer)},24:function(e,t,n){e.exports=n(43)},29:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(18),c=n.n(o),s=(n(29),n(7)),i=n(9),u=n(6),l=n(13),m=n.n(l),f=n(19),p=n(2),b="APP_SET_IPFS_NODE",d="CHAT_SET_USER",g="CHAT_SET_TOPIC",v="CHAT_PUSH_MESSAGE",h=function(e){return{type:v,payload:e}},E=function(e){return{type:d,payload:e}},w=function(e){return{type:g,payload:e}},O=function(e){return{type:b,payload:e}};var j=Object(u.d)(function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(""),i=Object(s.a)(c,2),u=i[0],l=i[1],m=Object(a.useContext)(p.a),f=Object(a.useCallback)(function(e){e.preventDefault(),m(E(n)),m(w(u))},[n,u,m]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:f},r.a.createElement("input",{value:n,onChange:function(e){return o(e.target.value)},placeholder:"your user name"}),r.a.createElement("input",{className:"mg-bottom-16",value:u,onChange:function(e){return l(e.target.value)},placeholder:"topic to subscribe"}),r.a.createElement("button",{type:"submit"},"join!")))});var y=Object(u.d)(function(e){var t=Object(a.useContext)(p.b),n=Object(a.useContext)(p.a),o=e.history;return Object(a.useEffect)(function(){if(t.user&&t.topic){console.log("should init ipfs");try{var e=new window.Ipfs({EXPERIMENTAL:{pubsub:!0},repo:"ipfs-".concat(Math.random()),config:{Addresses:{Swarm:["/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star"]}}});e.once("start",Object(f.a)(m.a.mark(function a(){return m.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.id();case 2:a.sent&&(e.pubsub.subscribe(t.topic,function(e){n(h(e))},console.error),n(O(e)),o.push("/chat"));case 4:case"end":return a.stop()}},a)})))}catch(a){console.error(a)}}},[t.user,t.topic,n,o]),r.a.createElement("div",{className:"page__join"},r.a.createElement("div",{className:"mg-bottom-32"},r.a.createElement("h1",null,"Hellow"),r.a.createElement("h4",null,"Welcome to IPFS Chat!")),r.a.createElement(j,null))});function C(){var e=Object(a.useContext)(p.b),t=e.user,n=e.topic;return r.a.createElement("header",{className:"header"},r.a.createElement("p",null,t," ","@"," ",n))}function S(){var e=Object(a.useContext)(p.b).messages;return Object(a.useEffect)(function(){console.log("new message! ",e)},[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"messages"},e.map(function(e){var t=e.seqno.toString(),n=e.data.toString(),a=JSON.parse(n);return r.a.createElement("li",{key:t},r.a.createElement("div",{className:"message"},r.a.createElement("p",{className:"message__author"},a.fromUser),r.a.createElement("p",{className:"message__text"},a.message)))})))}var _=n(22);var N=Object(u.d)(function(e){var t=Object(a.useContext)(p.b).ipfs,n=e.history;return Object(a.useEffect)(function(){t||n.push("/")},[n,t]),r.a.createElement("div",{className:"page__chat"},r.a.createElement(C,null),r.a.createElement(S,null),r.a.createElement(_.a,null))}),k=n(23),x=n(10),A={user:null,topic:"",messages:[],ipfs:null};function P(e,t){switch(t.type){case v:return Object(x.a)({},e,{messages:[].concat(Object(k.a)(e.messages),[t.payload])});case d:return Object(x.a)({},e,{user:t.payload});case g:return Object(x.a)({},e,{topic:t.payload});case b:return Object(x.a)({},e,{ipfs:t.payload});default:return e}}var T=function(){var e=Object(a.useReducer)(P,A),t=Object(s.a)(e,2),n=t[0],o=t[1];return r.a.createElement(p.a.Provider,{value:o},r.a.createElement(p.b.Provider,{value:n},r.a.createElement(i.a,null,r.a.createElement("div",{className:"page"},r.a.createElement(u.a,{path:"/",exact:!0,component:y}),r.a.createElement(u.a,{path:"/chat",component:N})))))},W=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function U(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}c.a.render(r.a.createElement(T,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/ipfs-chat",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/ipfs-chat","/service-worker.js");W?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):U(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):U(t,e)})}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.99344612.chunk.js.map