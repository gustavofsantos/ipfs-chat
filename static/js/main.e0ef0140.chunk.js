(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1:function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return o});var a=n(0),r=n.n(a),c=r.a.createContext(null),o=r.a.createContext(null)},22:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var a=n(7),r=n(0),c=n.n(r),o=n(1);function s(){var t=Object(r.useState)(""),n=Object(a.a)(t,2),s=n[0],u=n[1],i=Object(r.useContext)(o.b),l=i.ipfs,m=i.topic,f=i.user,p=Object(r.useCallback)(function(e){u(e.target.value)},[]),b=Object(r.useCallback)(function(t){t.preventDefault(),l.pubsub.publish(m,e.from(JSON.stringify({fromUser:f,message:s}))),u("")},[s,l,m,f]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("form",{className:"new-message",onSubmit:b},c.a.createElement("input",{className:"new-message__input",value:s,onChange:p}),c.a.createElement("button",{className:"new-message__button",type:"submit"},"send")))}}).call(this,n(39).Buffer)},24:function(e,t,n){e.exports=n(43)},29:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(18),o=n.n(c),s=(n(29),n(7)),u=n(9),i=n(6),l=n(13),m=n.n(l),f=n(19),p=n(1),b="APP_SET_IPFS_NODE",d="CHAT_SET_USER",g="CHAT_SET_TOPIC",v="CHAT_PUSH_MESSAGE",h=function(e){return{type:v,payload:e}},E=function(e){return{type:d,payload:e}},w=function(e){return{type:g,payload:e}},O=function(e){return{type:b,payload:e}};var j=Object(i.d)(function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),u=Object(s.a)(o,2),i=u[0],l=u[1],m=Object(a.useContext)(p.a),f=Object(a.useCallback)(function(e){e.preventDefault(),m(E(n)),m(w(i))},[n,i,m]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:f},r.a.createElement("input",{value:n,onChange:function(e){return c(e.target.value)},placeholder:"your user name"}),r.a.createElement("input",{className:"mg-bottom-16",value:i,onChange:function(e){return l(e.target.value)},placeholder:"topic to subscribe"}),r.a.createElement("button",{type:"submit"},"join!")))});var y=Object(i.d)(function(e){var t=Object(a.useContext)(p.b),n=Object(a.useContext)(p.a),c=e.history;return Object(a.useEffect)(function(){if(t.user&&t.topic)try{var e=new window.Ipfs({EXPERIMENTAL:{pubsub:!0},repo:"ipfs-".concat(Math.random()),config:{Addresses:{Swarm:["/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star"]}}});e.once("start",Object(f.a)(m.a.mark(function a(){return m.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.id();case 2:a.sent&&(e.pubsub.subscribe(t.topic,function(e){n(h(e))}),n(O(e)),c.push("/chat"));case 4:case"end":return a.stop()}},a)})))}catch(a){throw a}},[t.user,t.topic,n,c]),r.a.createElement("div",{className:"page__join"},r.a.createElement("div",{className:"mg-bottom-32"},r.a.createElement("h1",null,"Hellow"),r.a.createElement("h4",null,"Welcome to IPFS Chat!")),r.a.createElement(j,null))});function C(){var e=Object(a.useContext)(p.b),t=e.user,n=e.topic;return r.a.createElement("header",{className:"header"},r.a.createElement("p",null,t," ","@"," ",n))}function S(e){var t=e.message,n=Object(a.useContext)(p.b).user,c=t.seqno.toString(),o=t.data.toString(),s=JSON.parse(o),u="message ".concat(s.fromUser===n?"my-message":"other-message");return r.a.createElement("li",{key:c},r.a.createElement("div",{className:u},r.a.createElement("p",{className:"message__author"},s.fromUser),r.a.createElement("p",{className:"message__text"},s.message)))}function _(){var e=Object(a.useContext)(p.b).messages,t=Object(a.useRef)(null);return Object(a.useEffect)(function(){t.current.scrollIntoView({behavior:"smooth"})},[e,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"messages"},e.map(function(e){return r.a.createElement(S,{message:e})}),r.a.createElement("li",{ref:t})))}var N=n(22);var k=Object(i.d)(function(e){var t=Object(a.useContext)(p.b).ipfs,n=e.history;return Object(a.useEffect)(function(){t||n.push("/")},[n,t]),r.a.createElement("div",{className:"page__chat"},r.a.createElement(C,null),r.a.createElement(_,null),r.a.createElement(N.a,null))}),x=n(23),A=n(10),P={user:null,topic:"",messages:[],ipfs:null};function T(e,t){switch(t.type){case v:return Object(A.a)({},e,{messages:[].concat(Object(x.a)(e.messages),[t.payload])});case d:return Object(A.a)({},e,{user:t.payload});case g:return Object(A.a)({},e,{topic:t.payload});case b:return Object(A.a)({},e,{ipfs:t.payload});default:return e}}var U=function(){var e=Object(a.useReducer)(T,P),t=Object(s.a)(e,2),n=t[0],c=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a.Provider,{value:c},r.a.createElement(p.b.Provider,{value:n},r.a.createElement(u.a,{basename:"/ipfs-chat"},r.a.createElement("div",{className:"page"},r.a.createElement(i.a,{path:"/",exact:!0,component:y}),r.a.createElement(i.a,{path:"/chat",component:k}))))))},W=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function I(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}o.a.render(r.a.createElement(U,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/ipfs-chat",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/ipfs-chat","/service-worker.js");W?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):I(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):I(t,e)})}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.e0ef0140.chunk.js.map